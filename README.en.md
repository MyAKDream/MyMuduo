# My_muduo

[TOC]

## 项目名称

仿`Muduo`库的高性能`HTTP`服务器

## 功能模块划分

### server模块

1. 监听连接管理：多监听连接进行管理
2. 通信连接管理：对通信连接进行管理
3. 超时连接管理：对超时连接进行管理

#### Buffer子模块

`Buffer`是一个缓冲区模块

**功能**：实现通信中**用户态层面上的接收缓冲区和发送缓冲区功能**。

**意义**：
1. 防止我们接收到的数据不是一条完整的数据，因此对接受缓冲区进行缓冲
2. 对于客户端响应的数据，在**套接字可写的情况下**进行发送。

**功能设计**：
1. 向缓冲区中添加数据
2. 从缓冲区中取出数据

#### Socket子模块

**功能**：对套接字的操作进行封装

**意义**：方便使用

**功能**：
1. 创建套接字
2. 绑定地址信息
3. 开始监听
4. 向服务器发送链接请求
5. 获取新建的链接
6. 数据的接收和发送
7. 关闭套接字
8. 直接创建服务器连接和客户端连接

#### Channel模块

**功能**：对于一个描述符进行监控事件管理
**意义**：当一个描述符进行监控事件在用户态更容易维护，以及触发后的事件后的操作流程更加清晰。

**功能设计**：
1. 对监控事件的管理：对描述符进行监控，判断描述符是否可读是否可写，解除可读或可写的事件监控。
2. 对监控事件触发后的处理：对于不同事件设置**回调处理函数**，明确触发了某个事件之后应该怎么处理。

#### Connection模块

**功能**：
1. 对通信连接进行整体管理的一个模块，对一个连接的操作都是通过这个模块进行的。
2. 一个连接有任何事件该怎么处理，都会由Connection模块进行处理。

**意义**：这个模块本身说不是一个单独的功能模块，是一个对连接做管理的模块，**增加连接操作的灵活和便捷性**。

**功能设计**：
1. 关闭连接
2. 发送数据
3. 协议切换
4. 回调函数设置：
    - 连接建立完成数据时的回调。
    - 连接有新数据接收成功后的回调。
    - 连接关闭时的回调。
    - 产生任何事件进行的回调。

#### Acceptor模块

**功能**：对监听套接字进行管理。

**意义**：
1. 当获取了一个新建连接的描述符之后，需要为这个通信连接，封装一个`Connection`对象，设置各种不同的回调
2. 注意：因为`Accpeter`模块本身不知道连接产生了某个时间应该如何处理，因此获取一个通信连接后`Connection`的封装，以及时间回调的设置都应该由服务器模块来进行。

**功能设计**：回调函数设置，新建连接获取成功的回调设置。

#### TimerQueue模块

**功能**：定时任务模块，让一个任务指定在一段时间之后执行
**意义**：组件内部对于非活跃连接，希望在N秒之后被释放

**功能设计**：
1. 添加定时任务
2. 刷新定时任务：希望一个定时任务重新开始计时
3. 取消定时任务


#### Poller模块

**功能**：对任意的描述符进行`IO`事件监控，是一个对`epoll`进行的封装的一个模块

**意义**：对`epoll`进行封装，让描述符进行事件监控的操作更加简单

**功能接口**：
1. 添加事件监控 —— `Channel`模块。
2. 修改事件监控。
3. 移除事件监控。

#### EventLoop模块

**功能**：对连接事件监控管理的模块，这个模块其实就是`one thread one loop`中的`loop`，也就是`Reactor`模块。这个模块必然是一个模块对应一个线程。

**意义**：
1. 对于服务器中所以的事件都是由`EventLoop`模块来完成。
2. 每个`Connection`连接，都会绑定一个EvectLoop模块和线程，因为外界对于连接的所有操作，都是要放到同一个线程中进行的。

**思想**：
1. 对所有的连接进行事件监控：触发事件之后，调用回调进行处理
2. 对连接的所有操作，都要放到`EventLoop`线程中执行，将任务添加到任务队列中。

**功能设计**：
1. 将任务添加到执行队列。
2. 将定时器事件和刷新。
3. 定时任务的取消。

#### TcpServer模块

**功能**：对前面所有子模块的整合模块，是提供给用户一个高性能服务器方模块

**意义**：让使用者可以更加轻便的完成一个服务器搭建。

**功能**：
1. 对于监听连接的管理：获取一个新链接之后如何处理，由`Server`模块支持
2. 对于通信连接的管理：连接产生的某个事件如何处理，由`Server`模块支持
3. 对于超时连接的管理：连接非活跃超时是否关闭，由`Server`模块支持
4. 对于事件监控的管理：启动多少个线程，由多少个`EventLoop`，由`Server`模块设置。
5. 事件回调函数的设置：一个连接产生了一个事件，对于这个事件如何处理，由组件使用者设置。




